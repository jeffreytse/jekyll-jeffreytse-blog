<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>The handbook of Windows Batch | Jeffrey Tse’s Blog</title>
<meta name="generator" content="Jekyll v4.3.4">
<meta property="og:title" content="The handbook of Windows Batch">
<meta name="author" content="Jeffrey Tse">
<meta property="og:locale" content="en_US">
<meta name="description" content="Batch of Windows’ hidden secrets for productivity. With just a bit of work, you can automate monotonous tasks and never worry about them again. Power users should learn all about batch scripting (a set of commands) sooner rather than later. Here is a easy note for you to quickly learn about it.">
<meta property="og:description" content="Batch of Windows’ hidden secrets for productivity. With just a bit of work, you can automate monotonous tasks and never worry about them again. Power users should learn all about batch scripting (a set of commands) sooner rather than later. Here is a easy note for you to quickly learn about it.">
<link rel="canonical" href="https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html">
<meta property="og:url" content="https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html">
<meta property="og:site_name" content="Jeffrey Tse’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-10-30T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="The handbook of Windows Batch">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jeffrey Tse"},"dateModified":"2021-10-30T00:00:00+00:00","datePublished":"2021-10-30T00:00:00+00:00","description":"Batch of Windows’ hidden secrets for productivity. With just a bit of work, you can automate monotonous tasks and never worry about them again. Power users should learn all about batch scripting (a set of commands) sooner rather than later. Here is a easy note for you to quickly learn about it.","headline":"The handbook of Windows Batch","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html"},"url":"https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="/favicon.png">
  <link rel="canonical" href="https://jeffreytse.net">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://jeffreytse.net/feed.xml" title="Jeffrey Tse's Blog">
<!-- Google tag (gtag.js) -->
<script>
  function initGoogleAnalytics() {
    var doNotTrack = (window.doNotTrack === "1" || navigator.doNotTrack === "1" ||
      navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1");
    var enableDNT = "false" == "true";

    if (!enableDNT || !doNotTrack) {
      var measurementId = 'G-N54MN13CMZ';

      (function(src) {
        var tag = document.createElement('script');
        tag.src = src;
        tag.async = true;
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      })('https://www.googletagmanager.com/gtag/js?id=' + measurementId);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', measurementId);
    }
  }
  window.addEventListener("load", initGoogleAnalytics);
</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js" async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css" rel="stylesheet">
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Jeffrey Tse's Blog" src="/favicon.png" onerror="this.style.display='none'">
  Jeffrey Tse's Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/">HOME</a><a class="page-link" href="/archives.html">ARCHIVES</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/tags.html">TAGS</a><a class="page-link" href="/about.html">ABOUT</a>









<div class="page-link" style="display: inline;">



<div id="google_translate_element" style="display: none;">
</div>

<div class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="Franch">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</div>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
        document.dispatchEvent(new Event('theme-changed'));
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">The handbook of Windows Batch</h1>
  <h2 class="post-subtitle"></h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2021-10-30T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> 30 Oct 2021
    </time><span class="post-author left-vsplit"><i class="fa fa-pencil"></i> Jeffrey Tse</span>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 8 mins</span>
  </div>
<div class="post-tags">
<a class="post-tag" href="/tags.html#computer">#computer</a><a class="post-tag" href="/tags.html#note">#note</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <p>Batch of Windows’ hidden secrets for productivity. With just a bit of work,
you can automate monotonous tasks and never worry about them again. Power
users should learn all about batch scripting (a set of commands) sooner
rather than later.  Here is a easy note for you to quickly learn about it.</p>

<h2 id="output">Output</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Echo an empty line</span>
<span class="nb">echo</span>.
<span class="nb">echo</span><span class="o">,</span>
<span class="nb">echo</span>:
<span class="nb">echo</span><span class="o">;</span>
<span class="nb">echo</span><span class="o">=</span>
<span class="nb">echo</span><span class="o">+</span>
<span class="nb">echo</span>/
<span class="nb">echo</span><span class="o">[</span>
<span class="nb">echo</span><span class="o">]</span>
<span class="nb">echo</span><span class="o">(</span>
<span class="nb">echo</span>\

<span class="c">:: Turn off command echo</span>
<span class="nb">echo</span> <span class="na">off</span>

<span class="c">:: Turn off command echo including itself</span>
@echo <span class="na">off</span>

<span class="c">:: Provide a way to display remarks / comments on the screen</span>
<span class="c">rem This is a comment</span>
</code></pre></div></div>

<h2 id="assignment">Assignment</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Assign a value</span>
<span class="kd">set</span> <span class="kd">var</span><span class="o">=</span>

<span class="c">:: Assign value from input with a prompt</span>
<span class="kd">set</span> <span class="na">/p </span><span class="kd">var</span><span class="o">=</span><span class="s2">"Your prompt: "</span>

<span class="c">:: Assign value which is a result of an algorithic expression</span>
<span class="kd">set</span> <span class="kd">num</span><span class="o">=</span><span class="m">2</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">var</span><span class="o">=</span><span class="nv">%num%</span><span class="o">+</span><span class="m">1</span>
</code></pre></div></div>

<p>Here is an operator table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Operator</th>
      <th style="text-align: center">Function</th>
      <th style="text-align: center">Priority</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">( )</td>
      <td style="text-align: center">Grouping</td>
      <td style="text-align: center">0</td>
    </tr>
    <tr>
      <td style="text-align: center">! ~ -</td>
      <td style="text-align: center">Unary Operator</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">
<ul>
  <li>/ %</li>
</ul>
</td>
      <td style="text-align: center">Arithmetic</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Arithmetic</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">« »</td>
      <td style="text-align: center">Bitwise</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">&amp;</td>
      <td style="text-align: center">Logical AND</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center"></td>
      <td style="text-align: center">Logical NOT</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center" colspan="2">
</td>
      <td style="text-align: center">Logical OR</td>
      
    </tr>
    <tr>
      <td style="text-align: center">= *= /= %= += -=</td>
      <td style="text-align: center">Arithmetic assignment</td>
      <td style="text-align: center">8</td>
    </tr>
    <tr>
      <td style="text-align: center">&amp;= ^= |= «= »=</td>
      <td style="text-align: center">Arithmetic assignment</td>
      <td style="text-align: center">9</td>
    </tr>
    <tr>
      <td style="text-align: center">,</td>
      <td style="text-align: center">Delimiter</td>
      <td style="text-align: center">10</td>
    </tr>
  </tbody>
</table>

<h2 id="string-operations">String Operations</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">::===================================</span>
<span class="c">:: Replace substring</span>
<span class="c">::===================================</span>

<span class="kd">set</span> <span class="kd">var</span><span class="o">=</span><span class="s2">"foo bar baz"</span>
<span class="nb">echo</span> <span class="vm">%var</span><span class="nl">:bar</span><span class="o">=</span><span class="kd">foo</span><span class="err">%</span>
<span class="kd">foo</span> <span class="kd">foo</span> <span class="kd">baz</span>

<span class="c">::===================================</span>
<span class="c">:: Retrieve substring</span>
<span class="c">::===================================</span>

<span class="kd">set</span> <span class="kd">var</span><span class="o">=</span><span class="s2">"foo bar baz"</span>

<span class="c">:: Get</span>
<span class="nb">echo</span> <span class="vm">%var</span>:<span class="o">~,-</span><span class="m">4</span><span class="err">%</span>
<span class="kd">foo</span> <span class="kd">bar</span>

<span class="nb">echo</span> <span class="vm">%var</span>:<span class="o">~</span><span class="m">0</span><span class="o">,</span><span class="m">3</span><span class="err">%</span>
<span class="kd">foo</span>

<span class="c">:: Get the last one character</span>
<span class="nb">echo</span> <span class="vm">%var</span>:<span class="o">~-</span><span class="m">1</span><span class="err">%</span>
<span class="kd">z</span>

<span class="c">:: Get the</span>
<span class="nb">echo</span> <span class="vm">%var</span>:<span class="o">~-</span><span class="m">3</span><span class="o">,</span><span class="m">2</span><span class="err">%</span>
<span class="kd">baz</span>
</code></pre></div></div>

<h2 id="loop">Loop</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Iterate items</span>
<span class="k">for</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="kd">a</span> <span class="kd">b</span> <span class="kd">c</span><span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
<span class="kd">a</span>
<span class="kd">b</span>
<span class="kd">c</span>

<span class="c">:: Iterate numbers</span>
<span class="k">for</span> <span class="na">/l </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">,</span> <span class="m">5</span><span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
<span class="m">1</span>
<span class="m">3</span>
<span class="m">5</span>
<span class="m">7</span>
<span class="m">9</span>

<span class="c">:: Iterate string output</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"delims=,"</span> <span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="s2">"ab,cd"</span><span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%%i</span>
<span class="kd">ab</span>

<span class="c">:: Iterate command output</span>
<span class="k">for</span> <span class="na">/f </span><span class="s2">"delims="</span> <span class="vm">%i</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'echo 123 </span><span class="se">^&amp;</span><span class="s1"> echo 456'</span><span class="o">)</span> <span class="k">do</span> @echo <span class="vm">%i</span>
<span class="m">123</span>
<span class="m">456</span>
</code></pre></div></div>

<h2 id="function">Function</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Declare a variable as function return value</span>
<span class="kd">set</span> <span class="kd">retval</span><span class="o">=</span>

<span class="c">:: Call function</span>
<span class="k">call</span> <span class="nl">:my</span>_func <span class="s2">"hello"</span> <span class="s2">"world"</span>
<span class="nb">echo</span> <span class="kd">retval</span><span class="o">=</span><span class="nv">%retval%</span>

<span class="c">:: Define a simple function</span>
<span class="nl">:my</span>_func
  <span class="nb">echo</span> <span class="s2">"args: </span><span class="err">%</span><span class="s2">1 </span><span class="err">%</span><span class="s2">2"</span>
  <span class="kd">retval</span><span class="o">=</span><span class="m">1</span>
<span class="k">goto</span><span class="nl">:eof</span>
</code></pre></div></div>

<h2 id="extension-variables">Extension Variables</h2>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: This batch file save as C:\foo\bar.bat</span>

<span class="c">:: The batch full path</span>
<span class="nb">echo</span> <span class="err">%</span><span class="m">0</span>
<span class="s2">"C:\foo\bar.bat"</span>

<span class="c">:: The batch file directory</span>
<span class="nb">echo</span> <span class="nv">%cd%</span>
<span class="kd">C</span>:\foo

<span class="c">:: The batch file name</span>
<span class="nb">echo</span> <span class="err">%</span><span class="o">~</span><span class="m">0</span>
<span class="kd">bar</span>.bat

<span class="c">:: The batch file full path</span>
<span class="nb">echo</span> <span class="vm">%~f0</span>
<span class="kd">C</span>:\foo\bar.bat

<span class="c">:: The disk drive of batch file</span>
<span class="nb">echo</span> <span class="vm">%~d0</span>
<span class="kd">C</span>:

<span class="c">:: The relative path of batch file directory</span>
<span class="nb">echo</span> <span class="vm">%~p0</span>
\foo\

<span class="c">:: The absolute path of batch file directory</span>
<span class="nb">echo</span> <span class="vm">%~dp0</span>
<span class="kd">C</span>:\foo\

<span class="c">:: The batch file basename</span>
<span class="nb">echo</span> <span class="vm">%~n0</span>
<span class="kd">bar</span>

<span class="c">:: The batch file extname</span>
<span class="nb">echo</span> <span class="vm">%~x0</span>
.bat

<span class="c">:: The batch file fullname (basename + extname)</span>
<span class="nb">echo</span> <span class="vm">%~nx0</span>

<span class="c">:: The batch file short path</span>
<span class="nb">echo</span> <span class="vm">%~s0</span>

<span class="c">:: The batch file attributes</span>
<span class="nb">echo</span> <span class="vm">%~a0</span>

<span class="c">:: The batch file created time</span>
<span class="nb">echo</span> <span class="vm">%~t0</span>

<span class="c">:: The batch file size</span>
<span class="nb">echo</span> <span class="vm">%~z0</span>

<span class="c">::============================</span>

<span class="c">:: Current Directory (Working Directory)</span>
<span class="nb">echo</span> <span class="nv">%cd%</span>

<span class="c">:: Current OS name</span>
<span class="nb">echo</span> <span class="nv">%os%</span>
<span class="kd">Windows_NT</span>

<span class="c">:: System Date (Date format based on system locale)</span>
<span class="nb">echo</span> <span class="nv">%date%</span>
<span class="m">12</span>/31/2021 <span class="kd">Fri</span>

<span class="c">:: System Time (HH:MM:SS.SS)</span>
<span class="nb">echo</span> <span class="nv">%time%</span>

<span class="c">:: Search path for executable files</span>
<span class="nb">echo</span> <span class="nv">%path%</span>

<span class="c">:: Extension name list of executable files</span>
<span class="nb">echo</span> <span class="nv">%pathext%</span>

<span class="c">:: Home path of current user</span>
<span class="nb">echo</span> <span class="nv">%homepath%</span>
\Users\Administrator

<span class="c">:: User profile</span>
<span class="nb">echo</span> <span class="nv">%userprofile%</span>
<span class="kd">C</span>:\Users\Administrator

<span class="c">:: Windows directory</span>
<span class="nb">echo</span> <span class="nv">%windir%</span>
<span class="kd">C</span>:\windows

<span class="c">:: Random number (0~32767)</span>
<span class="nb">echo</span> <span class="nv">%random%</span>
<span class="m">34521</span>

<span class="c">:: Last error code (Non-zero)</span>
<span class="nb">echo</span> <span class="nv">%errorlevel%</span>
<span class="o">-</span><span class="m">1</span>

<span class="c">:: Computer name</span>
<span class="nb">echo</span> <span class="nv">%computername%</span>

<span class="c">:: Username</span>
<span class="nb">echo</span> <span class="nv">%username%</span>
<span class="kd">Administrator</span>

<span class="c">:: System Drive</span>
<span class="nb">echo</span> <span class="nv">%systemdrive%</span>
<span class="kd">C</span>:

<span class="c">:: System Root</span>
<span class="nb">echo</span> <span class="nv">%systemroot%</span>
<span class="kd">C</span>:\Windows

<span class="c">:: Home Drive</span>
<span class="nb">echo</span> <span class="nv">%homedrive%</span>

<span class="c">:: Home Share</span>
<span class="nb">echo</span> <span class="nv">%homeshare%</span>

<span class="c">:: The number of processors</span>
<span class="nb">echo</span> <span class="nv">%number_of_processors%</span>
<span class="m">8</span>

<span class="c">:: The level of processor</span>
<span class="nb">echo</span> <span class="nv">%processor_level%</span>
<span class="m">15</span>

<span class="c">:: Application data directory</span>
<span class="nb">echo</span> <span class="nv">%appdata%</span>
<span class="kd">C</span>:\Documents <span class="kd">and</span> <span class="kd">Settings</span>\Administrator\Application <span class="kd">Data</span>

<span class="c">:: All users profile directory</span>
<span class="nb">echo</span> <span class="nv">%allusersprofile%</span>
<span class="kd">C</span>:\Documents <span class="kd">and</span> <span class="kd">Settings</span>\All <span class="kd">Users</span>

<span class="c">:: The command line of current batch program</span>
<span class="nb">echo</span> <span class="nv">%cmdcmdline%</span>
<span class="nb">cmd</span> <span class="na">/c </span><span class="s2">"C:\Documents and Settings\Administrator\Desktop\foo.bat"</span>

<span class="c">:: The extension version of current command processor</span>
<span class="nb">echo</span> <span class="nv">%cmdextversion%</span>
<span class="m">2</span>

<span class="c">:: The command interpreter</span>
<span class="nb">echo</span> <span class="nv">%comspec%</span>
<span class="kd">C</span>:\windows\system32\cmd.exe

<span class="c">:: The logon server for DC (Domain Controller) verification</span>
<span class="nb">echo</span> <span class="nv">%logonserver%</span>
\xxxx

<span class="c">:: Processor architecture (x86 or IA64 based on Itanium x86)</span>
<span class="nb">echo</span> <span class="nv">%processor_architecture%</span>
<span class="kd">AMD64</span>

<span class="c">:: Processor identifier (Detail model specification)</span>
<span class="nb">echo</span> <span class="nv">%processor_identfier%</span>
<span class="kd">Intel64</span> <span class="kd">Family</span> <span class="m">6</span> <span class="kd">Model</span> <span class="m">142</span> <span class="kd">Stepping</span> <span class="m">10</span><span class="o">,</span> <span class="kd">GenuineIntel</span>

<span class="c">:: Processor revision</span>
<span class="nb">echo</span> <span class="nv">%processor_revision%</span>
<span class="m">4</span><span class="kd">f02</span>

<span class="c">:: Current interpreter command prompt setting</span>
<span class="nb">echo</span> <span class="nv">%prompt%</span>
$P$G

<span class="c">:: Temp directory</span>
<span class="nb">echo</span> <span class="nv">%temp%</span>
<span class="kd">C</span>:\Users\Administrator\AppData\Local\Temp

<span class="c">:: The same as %tmp%</span>
<span class="nb">echo</span> <span class="nv">%tmp%</span>
<span class="kd">C</span>:\Users\Administrator\AppData\Local\Temp

<span class="c">:: User domain</span>
<span class="nb">echo</span> <span class="nv">%userdomain%</span>
<span class="kd">xxxx</span>
</code></pre></div></div>

<h2 id="miscellaneous">Miscellaneous</h2>

<h3 id="variable-expansion">Variable Expansion</h3>

<p>To expand variables at execution time rather than at parse time, we should
use the option <a href="http://ss64.com/nt/delayedexpansion.html">Enable Delay Expansion</a></p>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Enable delayed expansion of variables (Available in Batch file)</span>
<span class="nb">setlocal</span> <span class="na">enabledelayedexpansion</span>

<span class="kd">set</span> <span class="kd">str</span><span class="o">=</span><span class="s2">"foo bar baz"</span>
<span class="kd">set</span> <span class="nb">start</span><span class="o">=</span><span class="m">0</span>
<span class="kd">set</span> <span class="kd">len</span><span class="o">=</span><span class="m">3</span>
<span class="kd">set</span> <span class="s2">"var=</span><span class="err">!</span><span class="s2">str:~</span><span class="nv">%start%</span><span class="s2">,</span><span class="nv">%len%!</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="others">Others</h3>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: Pause with a prompt</span>
<span class="nb">pause</span>

<span class="c">:: Pause without a prompt</span>
<span class="nb">pause</span><span class="o">&gt;</span><span class="kr">nul</span>

<span class="c">:: Exit the batch with exitCode</span>
<span class="k">exit</span> \b <span class="m">0</span>

<span class="c">:: Standar output redirection</span>
<span class="o">&gt;</span><span class="kr">nul</span>
<span class="m">1</span><span class="o">&gt;</span><span class="kr">nul</span>

<span class="c">:: Error output redirection</span>
<span class="m">2</span><span class="o">&gt;</span><span class="kr">nul</span>

<span class="c">:: we should escape in `for` loop</span>
<span class="m">2</span><span class="se">^&gt;</span><span class="kr">nul</span>

<span class="c">:: Run without any output</span>
<span class="nb">del</span> <span class="kd">c</span>:\foo.txt <span class="m">1</span><span class="o">&gt;</span><span class="kr">nul</span> <span class="m">2</span><span class="o">&gt;</span><span class="kr">nul</span>
</code></pre></div></div>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://ss64.com/nt/">An A-Z Index of Windows CMD commands</a></li>
  <li><a href="https://ss64.com/nt/setlocal.html">SetLocal Command</a></li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/computer/2021/09/16/the-handbook-of-UML.html" title="The handbook of UML">
          <div>The handbook of UML</div>
        </a><a class="next" href="/computer/2021/10/31/the-keyboard-shortcuts-in-windows.html" title="The keyboard shortcuts in Windows">
          <div>The keyboard shortcuts in Windows</div>
        </a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="">
          <a class="post-link" href="/computer/2020/10/19/fix-warning-setlocale-cannot-change-locale.html" title="Fix warning setlocale cannot change locale">
            Fix warning setlocale cannot change locale<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/computer/2022/12/13/the-handbook-of-system-design.html" title="The Handbook of System Design">
            The Handbook of System Design<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/linguistics/2023/05/02/the-summary-of-linking-words-in-english.html" title="The Summary of Linking Words in English">
            The Summary of Linking Words in English<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/linguistics/2020/01/01/english-phrase-patterns.html" title="English Phrase Patterns">
            English Phrase Patterns<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
</ul>
    </div>
<div class="post-comments">  <div id="disqus_recommendations"></div>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html';
      this.page.identifier = 'https://jeffreytse.net/computer/2021/10/30/the-handbook-of-windows-batch.html';
    };

    // Disqus recommendations
    (function() {
      if (false === false) {
        return
      }
      var d = document, s = d.createElement('script');
      s.src = 'https://jeffreytse.disqus.com/recommendations.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();

    // Disqus comments
    (function() {
      if (true === false) {
        return
      }
      var d = document, s = d.createElement('script');
      s.src = 'https://jeffreytse.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();

    // Disqus theme switching
    document.addEventListener('theme-changed', function (e) {
      if (document.readyState == 'complete') {
        setTimeout(function () {
          if (window.DISQUS_RECOMMENDATIONS) {
            window.DISQUS_RECOMMENDATIONS.reset({ reload: true });
          }
          if (window.DISQUS) {
            window.DISQUS.reset({ reload: true, config: disqus_config });
          }
        }, 100);
      }
    });
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Copyright © 2008-2020</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
