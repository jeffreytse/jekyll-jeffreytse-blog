<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Miscellaneous of OpenSSL | Jeffrey Tse’s Blog</title>
<meta name="generator" content="Jekyll v4.3.4">
<meta property="og:title" content="Miscellaneous of OpenSSL">
<meta name="author" content="Jeffrey Tse">
<meta property="og:locale" content="en_US">
<meta name="description" content="Generating RSA key pair">
<meta property="og:description" content="Generating RSA key pair">
<link rel="canonical" href="https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html">
<meta property="og:url" content="https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html">
<meta property="og:site_name" content="Jeffrey Tse’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-08-18T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Miscellaneous of OpenSSL">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jeffrey Tse"},"dateModified":"2020-08-18T00:00:00+00:00","datePublished":"2020-08-18T00:00:00+00:00","description":"Generating RSA key pair","headline":"Miscellaneous of OpenSSL","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html"},"url":"https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="/favicon.png">
  <link rel="canonical" href="https://jeffreytse.net">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://jeffreytse.net/feed.xml" title="Jeffrey Tse's Blog">
<!-- Google tag (gtag.js) -->
<script>
  function initGoogleAnalytics() {
    var doNotTrack = (window.doNotTrack === "1" || navigator.doNotTrack === "1" ||
      navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1");
    var enableDNT = "false" == "true";

    if (!enableDNT || !doNotTrack) {
      var measurementId = 'G-N54MN13CMZ';

      (function(src) {
        var tag = document.createElement('script');
        tag.src = src;
        tag.async = true;
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      })('https://www.googletagmanager.com/gtag/js?id=' + measurementId);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', measurementId);
    }
  }
  window.addEventListener("load", initGoogleAnalytics);
</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js" async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css" rel="stylesheet">
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Jeffrey Tse's Blog" src="/favicon.png" onerror="this.style.display='none'">
  Jeffrey Tse's Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/">HOME</a><a class="page-link" href="/archives.html">ARCHIVES</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/tags.html">TAGS</a><a class="page-link" href="/about.html">ABOUT</a>









<div class="page-link" style="display: inline;">



<div id="google_translate_element" style="display: none;">
</div>

<div class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="Franch">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</div>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
        document.dispatchEvent(new Event('theme-changed'));
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Miscellaneous of OpenSSL</h1>
  <h2 class="post-subtitle"></h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2020-08-18T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> 18 Aug 2020
    </time><span class="post-author left-vsplit"><i class="fa fa-pencil"></i> Jeffrey Tse</span>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 11 mins</span>
  </div>
<div class="post-tags">
<a class="post-tag" href="/tags.html#computer">#computer</a><a class="post-tag" href="/tags.html#linux">#linux</a><a class="post-tag" href="/tags.html#misc">#misc</a><a class="post-tag" href="/tags.html#note">#note</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h2 id="generating-rsa-key-pair">Generating RSA key pair</h2>

<p>OpenSSL can generate several kinds of public/private keypairs. RSA is the most
common kind of keypair generation.</p>

<h3 id="generating-an-rsa-private-key">Generating an RSA private key</h3>

<p>You can generate a 2048-bit RSA private key with the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> rsa_private.pem <span class="se">\</span>
  <span class="nt">-pkeyopt</span> rsa_keygen_bits:2048
</code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> rsa_private.pem 2048
</code></pre></div></div>

<p>Execute this command to make a 2048-bit encrypted private key file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> rsa_private.pem <span class="nt">-aes256</span> 2048
</code></pre></div></div>

<p>To get the supported encryption algorithms with the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl enc <span class="nt">-list</span>
</code></pre></div></div>

<p>Some encryption algorithms as below:</p>

<ul>
  <li>-aes256</li>
  <li>-aes-256-cbc</li>
  <li>-aria256</li>
  <li>-aria-256-ofb</li>
  <li>…</li>
</ul>

<h3 id="extracting-the-public-key-from-an-rsa-private-key">Extracting the public key from an RSA private key</h3>

<p>In the RSA algorithm the public key is build using the modulus and the public
exponent, which means that we can always derive the public key from the private
key. OpenSSL can easily do this with the rsa module, producing the public key
in PEM format.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa <span class="nt">-in</span> rsa_private.pem <span class="nt">-pubout</span> <span class="nt">-out</span> rsa_public.pem
</code></pre></div></div>

<p>It is relatively easy to do some cryptographic calculations to calculate the
public key from the prime1 and prime2 values in the public key file.</p>

<p>However, OpenSSL has already pre-calculated the public key and stored it in the
private key file.</p>

<p>So this command doesn’t actually do any cryptographic calculation, it merely
copies the public key bytes out of the file and writes the Base64 PEM encoded
version of those bytes into the output public key file.</p>

<h3 id="generating-rsa-key-pair-with-ssh-keygen">Generating RSA key pair with ssh-keygen</h3>

<p>Other popular ways of generating RSA public/private key pairs is ssh-keygen.
You can generate 2048-bit RSA key pair with the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-b</span> 2048 <span class="nt">-t</span> rsa
</code></pre></div></div>

<h3 id="generating-an-rsa-key-with-a-self-signed-x509-certificate">Generating an RSA key with a self-signed X.509 certificate</h3>

<p>To generate a 2048-bit RSA private key and a self-signed X.509 certificate with
a SHA-256 signature, run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> rsa_private.pem <span class="se">\</span>
    <span class="nt">-out</span> rsa_cert.pem <span class="nt">-subj</span> <span class="s2">"/CN=unused"</span>
</code></pre></div></div>

<h2 id="viewing-the-key-elements">Viewing the key elements</h2>

<p>This format is called PEM (Privacy-Enhanced Email). The private key is encoded
as a big blob of Base64 text.</p>

<p>To parse it, you need to use the “rsa” command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa <span class="nt">-text</span> <span class="nt">-in</span> rsa_private.pem

</code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa <span class="nt">-text</span> &lt; rsa_private.pem
</code></pre></div></div>

<p>or use the “asn1parse” command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl asn1parse <span class="nt">-inform</span> pem <span class="nt">-in</span> rsa_private.pem
</code></pre></div></div>

<p>or for PKCS8 format:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl asn1parse <span class="nt">-inform</span> pem <span class="nt">-in</span> rsa_private.pem <span class="nt">-strparse</span> 22
</code></pre></div></div>

<p>Note that the ASN.1 structure contains the type of the object (rsaEncryption,
in this case). You can further decode the <code class="language-plaintext highlighter-rouge">OCTET STRING</code> field, which is the
actual key, specifying the offset 22.</p>

<p>While the <code class="language-plaintext highlighter-rouge">asn1parse</code> module is a generic ASN.1 parser, the <code class="language-plaintext highlighter-rouge">rsa</code> module knows the
structure of an RSA key and can properly output the field names.</p>

<h2 id="key-file-encoding">Key File Encoding</h2>

<p>Key data may be encoded in three general ways:</p>

<h3 id="binary-der-encoded-format">Binary DER-encoded format</h3>

<p>This is sometimes called ASN.1 BER-encoded (there is a subtle difference between
BER- and DER-encodings: DER is just a stricter subset of BER, but consider them
the same here). The most compact form. If you try to view the file with a text
editor it is full of “funny” characters. The first byte in the file should be a
‘0’ character (U+0030).</p>

<h3 id="pem-or-base64-format">PEM or base64 format</h3>

<p>It is the same data as the DER-encoded file but it is encoded in base64 with
additional header and footer lines (<a href="https://www.ietf.org/rfc/rfc7468.txt">RFC 7518</a>, Textual Encodings of PKIX, PKCS, and CMS Structures):</p>

<pre><code class="language-txt">-----BEGIN LABEL-----
MIICLDCCAdKgAwIBAgIBADAKBggqhkjOPQQDAjB9MQswCQYDVQQGEwJCRTEPMA0G
A1UEChMGR251VExTMSUwIwYDVQQLExxHbnVUTFMgY2VydGlmaWNhdGUgYXV0aG9y
aXR5MQ8wDQYDVQQIEwZMZXV2ZW4xJTAjBgNVBAMTHEdudVRMUyBjZXJ0aWZpY2F0
...
-----END LABEL-----
</code></pre>

<p>The PEM format is used to store cryptographic keys the body of the content
is in a format called PKCS #8. Initially a standard created by a private company
(RSA Laboratories), it became a de facto standard so has been described in
various RFCs, most notably <a href="https://www.ietf.org/rfc/rfc5208.txt">RFC 5208</a>,
Public-Key Cryptography Standards (PKCS) #8: Private-Key Information Syntax
Specification Version 1.2.</p>

<p>The PKCS#8 format describes the content using the <a href="https://en.wikipedia.org/wiki/Abstract_Syntax_Notation_One">ASN.1</a>
(Abstract Syntax Notation One) description language and the relative DER
(Distinguished Encoding Rules) to serialize the resulting structure. This
means that Base64-decoding the content will return some binary content
that can be processed only by an ASN.1 parser.</p>

<p>Let’s visually recap the structure:</p>

<pre><code class="language-txt">-----BEGIN label-----
+--------------------------- Base64 ---------------------------+
|                                                              |
| PKCS#8 content:                                              |
| ASN.1 language serialized with DER                           |
|                                                              |
+--------------------------------------------------------------+
-----END label-----
</code></pre>

<p>Please note that, due to the structure of the underlying ASN.1 structure, every
PEM body starts with the MII characters.</p>

<p>The first version of the PKCS standard (PKCS#1) was specifically tailored to
contain an RSA key. Its ASN.1 definition can be found in
<a href="https://www.ietf.org/rfc/rfc8017.txt">RFC 8017</a>, PKCS#1: RSA Cryptography
Specifications Version 2.2.</p>

<p>Subsequently, as the need to describe new types of algorithms increased, the
PKCS#8 standard was developed. This can contain different types of keys, and
defines a specific field for the algorithm identifier. Its ASN.1 definition
can be found in <a href="https://www.ietf.org/rfc/rfc5958.txt">RFC 5958</a>, Asymmetric
Key Packages.</p>

<h3 id="xml-format">XML format</h3>

<p>There are W3C standards for this, and, er, a .NET way that predates the latest
W3C standard. Here is an example of the W3C
(<a href="http://www.w3.org/TR/xkms2/">XKMS</a>) 2.0 format.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;RSAKeyPair&gt;</span>
  <span class="nt">&lt;Modulus&gt;</span>4IlzOY3Y9fXoh3Y5f06wBbtTg94Pt6vcfcd1KQ0FLm0S36aGJtTSb6pYKfyX7PqCUQ8wgL6xUJ5GRPEsu9
    gyz8ZobwfZsGCsvu40CWoT9fcFBZPfXro1Vtlh/xl/yYHm+Gzqh0Bw76xtLHSfLfpVOrmZdwKmSFKMTvNXOFd0V18=
  <span class="nt">&lt;/Modulus&gt;</span>
  <span class="nt">&lt;Exponent&gt;</span>AQAB<span class="nt">&lt;/Exponent&gt;</span>
  <span class="nt">&lt;P&gt;</span>9tbgIiFMXwpw/yf85bNQap3lD7WFlsZA+qgKtJubDFXCAR35N4KKFMjykw6SzaVmIbk80ga/tFUxydytypgt0Q==<span class="nt">&lt;/P&gt;</span>
  <span class="nt">&lt;Q&gt;</span>6N6wESUJ0gJRAd6K6JhQ9Xd3YaRFk2sIVZZzXfTIWxKTInOLf9Nwf/Wkqrt0/Twiato4kSqGW2wU6K5MnvqOLw==<span class="nt">&lt;/Q&gt;</span>
  <span class="nt">&lt;DP&gt;</span>l0zwh5sXf+4bgxsUtgtqkF+GJ1Hht6B/9eSI41m5+R6b0yl3OCJI1yKxJZi6PVlTt/oeILLIURYjdZNR56vN8Q==<span class="nt">&lt;/DP&gt;</span>
  <span class="nt">&lt;DQ&gt;</span>LPAkW/qgzYUi6tBuT/pszSHTyOTxhERIZHPXKY9+RozsFd7kUbOU5yyZLVVleyTqo2IfPmxNZ0ERO+G+6YMCgw==<span class="nt">&lt;/DQ&gt;</span>
  <span class="nt">&lt;InverseQ&gt;</span>
    WIjZoVA4hGqrA7y730v0nG+4tCol+/bkBS9u4oiJIW9LJZ7Qq1CTyr9AcewhJcV/+wLpIZa4M83ixpXub41fKA==
  <span class="nt">&lt;/InverseQ&gt;</span>
  <span class="nt">&lt;D&gt;</span>pAPDJ0d2NDRspoa1eUkBSy6K0shissfXSAlqi5H3NvJ11ujNFZBgJzFHNWRNlc1nY860n1asLzduHO4Ovygt9DmQb
    zTYbghb1WVq2EHzE9ctOV7+M8v/KeQDCz0Foo+38Y6idjeweVfTLyvehwYifQRmXskbr4saw+yRRKt/IQ==
  <span class="nt">&lt;/D&gt;</span>
<span class="nt">&lt;/RSAKeyPair&gt;</span>
</code></pre></div></div>

<p>The .NET version uses <rsakeyvalue> instead, which is strictly only for a public
key.</rsakeyvalue></p>

<h2 id="private-key-format">Private key format</h2>

<h3 id="rsa_pem-pkcs1">RSA_PEM (PKCS#1)</h3>

<p>RSAPrivateKey DER SEQUENCE (binary or PEM encoding)</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN RSA PRIVATE KEY</li>
</ul>

<h3 id="rsa_pem-pkcs8">RSA_PEM (PKCS#8)</h3>

<p>PrivateKeyInfo DER SEQUENCE (binary or PEM encoding)</p>

<p>A PKCS#8 file can be encrypted with a password to protect the private key.
PKCS#8 standard actually has two versions: non-encrypted and encrypted.</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN PRIVATE KEY (unencrypted)</li>
  <li>BEGIN ENCRYPTED PRIVATE KEY (encrypted)</li>
</ul>

<h2 id="public-key-format">Public key format</h2>

<h3 id="rsa_pem-pkcs1-1">RSA_PEM (PKCS#1)</h3>

<p>RSAPublicKey DER SEQUENCE (binary or PEM encoding). An RSA public key encoded
in base64. Can be used to verify RS256 signatures in JWT tokens
(<a href="https://www.ietf.org/rfc/rfc7518.txt">RFC 7518</a>).</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN RSA PUBLIC KEY</li>
</ul>

<p>If it uses PKCS #1, however, there has to be an external identification of the
algorithm, so the algorithm identification is placed in header and footer.</p>

<h3 id="rsa_x509_pem">RSA_X509_PEM</h3>

<p>An RSA_PEM key, encoded in base64, wrapped in an X.509v3 certificate
(<a href="https://www.ietf.org/rfc/rfc5280.txt">RFC 5280</a>).</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN PUBLIC KEY</li>
</ul>

<h3 id="es256_pem">ES256_PEM</h3>

<p>The public key for the ECDSA algorithm (using P-256 and SHA-256), encoded in
base64. Can be used to verify JWT tokens with the ES256 algorithm
(<a href="https://www.ietf.org/rfc/rfc7518.txt">RFC 7518</a>). This public key is not
wrapped in a certificate; this keeps the key size small, which is one of
ES256’s main advantages.</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN PUBLIC KEY</li>
</ul>

<h3 id="es256_x509_pem">ES256_X509_PEM</h3>

<p>An ES256_PEM key, encoded in base64, wrapped in a X.509v3 certificate
(<a href="https://www.ietf.org/rfc/rfc5280.txt">RFC 5280</a>).</p>

<p>PEM header:</p>

<ul>
  <li>BEGIN CERTIFICATE</li>
</ul>

<h2 id="the-openssh-public-key-format">The OpenSSH public key format</h2>

<p>The public key saved by ssh-keygen is written in the so-called SSH-format,
which is not a standard in the cryptography world. It’s structure is
<code class="language-plaintext highlighter-rouge">&lt;algorithm&gt; &lt;key&gt; &lt;comment&gt;</code>, where the <code class="language-plaintext highlighter-rouge">&lt;key&gt;</code> part of the format is
encoded with Base64.</p>

<p>For example:</p>

<pre><code class="language-txt">ssh-rsa AAAAB3NzaC1yfasDGdfG...sFASdqYk user@host
</code></pre>

<p>To manually decode the central part of the key you can run the following code:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>key.pub | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f2</span> | <span class="nb">base64</span> <span class="nt">-d</span> | hexdump <span class="nt">-ve</span> <span class="s1">'/1 "%02x "'</span> <span class="nt">-e</span> <span class="s1">'2/8 "\n"'</span>
</code></pre></div></div>

<p>The structure of this binary file is pretty simple, and is described in two
different RFCs. <a href="https://www.ietf.org/rfc/rfc4253.txt">RFC 4253</a>, SSH Transport
Layer Protocol, states in section 6.6 that:</p>

<pre><code class="language-txt">The "ssh-rsa" key format has the following specific encoding:

string    "ssh-rsa"
mpint     e
mpint     n
</code></pre>

<p>while the definition of the string and mpint types can be found in
<a href="https://www.ietf.org/rfc/rfc4251.txt">RFC 4251</a>, SSH Protocol Architecture,
section 5 that:</p>

<pre><code class="language-txt">string

    [...] They are stored as a uint32 containing its length
    (number of bytes that follow) and zero (= empty string) or more
    bytes that are the value of the string.  Terminating null
    characters are not used. [...]

mpint

    Represents multiple precision integers in two's complement format,
    stored as a string, 8 bits per byte, MSB first. [...]
</code></pre>

<p>This means that the above sequence of bytes is interpreted as 4 bytes of length
(32 bits of the uint32 type) followed by that number of bytes of content.</p>

<pre><code class="language-txt">(4 bytes)   00 00 00 07          = 7
(7 bytes)   73 73 68 2d 72 73 61 = "ssh-rsa" (US-ASCII)
(4 bytes)   00 00 00 03          = 3
(3 bytes)   01 00 01             = 65537 (a common value for the RSA exponent)
(4 bytes)   00 00 01 01          = 257
(257 bytes) 00 b2 .. ca a6 0d    = The key modulus
</code></pre>

<p>Please note that since we created a key of 2048 bits we should have a modulus of
256 bytes. Instead this key uses 257 bytes prefixing the number with a 00 byte
to avoid it being interpreted as negative (two’s complement format).</p>

<p>The structure shown above is the reason why all the RSA public SSH keys start
with the same 12 characters <code class="language-plaintext highlighter-rouge">AAAAB3NzaC1y</code>. This string, converted in Base64
gives the initial 9 bytes <code class="language-plaintext highlighter-rouge">00 00 00 07 73 73 68 2d 72</code> (Base64 characters are
not a one-to-one mapping of the source bytes). If the exponent is the standard
65537 the key starts with <code class="language-plaintext highlighter-rouge">AAAAB3NzaC1yc2EAAAADAQAB</code>, which encoded gives the
fist 18 bytes <code class="language-plaintext highlighter-rouge">00 00 00 07 73 73 68 2d 72 73 61 00 00 00 03 01 00 01</code>.</p>

<h2 id="converting-pempkcs1-to-pempkcs8">Converting PEM/PKCS#1 to PEM/PKCS#8</h2>

<p>To convert it, you need to use the “pkcs8” command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl pkcs8 <span class="nt">-topk8</span> <span class="nt">-inform</span> PEM <span class="nt">-outform</span> PEM <span class="nt">-in</span> rsa_private.pem <span class="se">\</span>
    <span class="nt">-nocrypt</span> <span class="o">&gt;</span> rsa_private.pkcs8.pem
</code></pre></div></div>

<h2 id="converting-openssh-public-to-pempkcs8">Converting OpenSSH public to PEM/PKCS#8</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-e</span> <span class="nt">-f</span> rsa_public.pub <span class="nt">-m</span> PKCS8 <span class="o">&gt;</span> rsa_public.pem
</code></pre></div></div>

<h2 id="converting-pempkcs8-to-openssh-public">Converting PEM/PKCS#8 to OpenSSH public</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-i</span> <span class="nt">-f</span> rsa_public.pem <span class="nt">-m</span> PKCS8 <span class="o">&gt;</span> rsa_public.pub
</code></pre></div></div>

<h2 id="key-file-extension">Key File Extension</h2>

<ul>
  <li>X.509 public key certificates are usually named <code class="language-plaintext highlighter-rouge">.cer</code> or <code class="language-plaintext highlighter-rouge">.der</code>
</li>
  <li>A textual PEM-format version might be named <code class="language-plaintext highlighter-rouge">.pem</code> or <code class="language-plaintext highlighter-rouge">.crt</code>
</li>
  <li>Private keys stored using the PKCS#8 convention are conventionally named <code class="language-plaintext highlighter-rouge">.p8</code>
or <code class="language-plaintext highlighter-rouge">.p8e</code>, but you’ll also find <code class="language-plaintext highlighter-rouge">.pri</code>, <code class="language-plaintext highlighter-rouge">.key</code>, <code class="language-plaintext highlighter-rouge">.bin</code> and <code class="language-plaintext highlighter-rouge">.pem</code> being used</li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://samsclass.info/141/proj/pCH-RKF.htm">RSA Key Formats</a></li>
  <li><a href="https://www.cryptosys.net/pki/rsakeyformats.html">RSA Key Formats</a></li>
  <li><a href="https://cloud.google.com/iot/docs/how-tos/credentials/keys">Creating Key pairs</a></li>
  <li><a href="https://en.wikibooks.org/wiki/Cryptography/Generate_a_keypair_using_OpenSSL#cite_note-5">Cryptography/Generate a keypair using OpenSSL</a></li>
  <li><a href="https://www.thedigitalcatonline.com/blog/2018/04/25/rsa-keys/">Public key cryptography: RSA keys</a></li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/misc/2020/08/17/understanding-of-abstract-and-concrete.html" title="Understanding of abstract and concrete">
          <div>Understanding of abstract and concrete</div>
        </a><a class="next" href="/computer/2020/08/26/hash-algorithms.html" title="Hash Algorithms">
          <div>Hash Algorithms</div>
        </a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="">
          <a class="post-link" href="/methodology/2023/01/14/how-to-use-the-orid-framework.html" title="How to Use the ORID Framework">
            How to Use the ORID Framework<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/methodology/2023/05/17/the-handbook-of-effective-presentations.html" title="The Handbook of Effective Presentations">
            The Handbook of Effective Presentations<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/computer/2024/05/17/naming-conventions-in-software-development.html" title="Naming Conventions in Software Development">
            Naming Conventions in Software Development<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/computer/2020/10/15/fix-error-about-non-empty-sec-websocket-protocol-header.html" title="Fix error about non-empty Sec-WebSocket-Protocol header">
            Fix error about non-empty Sec-WebSocket-Protocol header<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
</ul>
    </div>
<div class="post-comments">  <div id="disqus_recommendations"></div>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html';
      this.page.identifier = 'https://jeffreytse.net/computer/2020/08/18/miscellaneous-of-openssl.html';
    };

    // Disqus recommendations
    (function() {
      if (false === false) {
        return
      }
      var d = document, s = d.createElement('script');
      s.src = 'https://jeffreytse.disqus.com/recommendations.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();

    // Disqus comments
    (function() {
      if (true === false) {
        return
      }
      var d = document, s = d.createElement('script');
      s.src = 'https://jeffreytse.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();

    // Disqus theme switching
    document.addEventListener('theme-changed', function (e) {
      if (document.readyState == 'complete') {
        setTimeout(function () {
          if (window.DISQUS_RECOMMENDATIONS) {
            window.DISQUS_RECOMMENDATIONS.reset({ reload: true });
          }
          if (window.DISQUS) {
            window.DISQUS.reset({ reload: true, config: disqus_config });
          }
        }, 100);
      }
    });
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Copyright © 2008-2020</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
